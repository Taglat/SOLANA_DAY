<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Coffee Loyalty - –°–∫–∞–Ω–∏—Ä—É–π –∏ –ø–æ–ª—É—á–∞–π NFT!</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .terracotta-bg {
            background: linear-gradient(135deg, #D2691E 0%, #CD853F 30%, #F5DEB3 70%, #FFF8DC 100%);
            min-height: 100vh;
        }
        .glass-card {
            background: rgba(255, 248, 220, 0.9);
            backdrop-filter: blur(15px);
            border: 1px solid rgba(210, 105, 30, 0.2);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }
        .terracotta-button {
            background: linear-gradient(135deg, #D2691E 0%, #CD853F 100%);
            color: white;
            border: none;
            box-shadow: 0 4px 15px rgba(210, 105, 30, 0.3);
            transition: all 0.3s ease;
        }
        .terracotta-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(210, 105, 30, 0.4);
        }
        .scan-area {
            background: linear-gradient(135deg, #8B4513 0%, #A0522D 100%);
            border: 3px dashed #D2691E;
        }
        .nft-card {
            background: linear-gradient(135deg, #FFF8DC 0%, #F5DEB3 100%);
            border: 2px solid #D2691E;
        }
        .rare-glow {
            animation: rareGlow 2s ease-in-out infinite alternate;
        }
        @keyframes rareGlow {
            from { box-shadow: 0 0 10px rgba(255, 215, 0, 0.5); }
            to { box-shadow: 0 0 20px rgba(255, 215, 0, 0.8); }
        }
    </style>
</head>
<body class="terracotta-bg">
    <!-- Header -->
    <div class="glass-card rounded-2xl p-4 m-4">
        <div class="flex items-center justify-between">
            <div class="flex items-center space-x-3">
                <div class="w-10 h-10 bg-orange-100 rounded-full flex items-center justify-center">
                    <span class="text-xl">‚òï</span>
                </div>
                <div>
                    <h1 class="text-xl font-bold text-orange-800">Coffee Loyalty</h1>
                    <p class="text-xs text-gray-600">–°–∫–∞–Ω–∏—Ä—É–π –∏ –ø–æ–ª—É—á–∞–π NFT!</p>
                </div>
            </div>
            <div class="text-right">
                <div id="wallet-info" class="text-xs text-gray-600">
                    <div id="wallet-address" class="font-mono">–ù–µ –ø–æ–¥–∫–ª—é—á–µ–Ω</div>
                    <div id="token-balance" class="font-bold text-orange-600">0 —Ç–æ–∫–µ–Ω–æ–≤</div>
                </div>
            </div>
        </div>
    </div>

    <div class="px-4 space-y-6">
        <!-- –ì–ª–∞–≤–Ω—ã–π –ø—Ä–∏–∑—ã–≤ –∫ –¥–µ–π—Å—Ç–≤–∏—é -->
        <div class="text-center mb-6">
            <h2 class="text-3xl font-bold text-orange-800 mb-2">üéØ –°–∫–∞–Ω–∏—Ä—É–π —á–µ–∫ –∏ –ø–æ–ª—É—á–∏ NFT!</h2>
            <p class="text-orange-700">–°–æ–±–µ—Ä–∏ –∫–æ–ª–ª–µ–∫—Ü–∏—é –∏ –ø–æ–ª—É—á–∏ –ø—Ä–∏–∑!</p>
        </div>

        <!-- –°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ–∫–∞ -->
        <div class="glass-card rounded-2xl p-6">
            <div class="text-center mb-4">
                <div class="w-16 h-16 bg-orange-100 rounded-full flex items-center justify-center mx-auto mb-3">
                    <span class="text-3xl">üì±</span>
                </div>
                <h3 class="text-xl font-bold text-orange-800 mb-2">–°–∫–∞–Ω–∏—Ä—É–π —á–µ–∫</h3>
                <p class="text-gray-600 text-sm">–í—Å—Ç–∞–≤—å QR-–∫–æ–¥ —Å —á–µ–∫–∞ –∏–ª–∏ –æ—Ç—Å–∫–∞–Ω–∏—Ä—É–π –∫–∞–º–µ—Ä–æ–π</p>
            </div>
            
            <div class="scan-area rounded-xl p-6 mb-4">
                <div class="flex flex-col items-center mt-2">
                    <input type="file" id="receipt-image" accept="image/*" class="mb-2" style="max-width: 220px;" />
                    <button id="scan-image-btn" onclick="scanReceiptImage()" class="terracotta-button py-2 px-4 rounded-lg text-sm font-bold">–°–∫–∞–Ω–∏—Ä–æ–≤–∞—Ç—å —á–µ–∫ –∏–∑ —Ñ–æ—Ç–æ</button>
                </div>
            </div>
            
            <button id="scan-btn" onclick="scanReceipt()" 
                class="terracotta-button w-full py-4 px-6 rounded-xl text-lg font-bold mb-3">
                üîç –°–∫–∞–Ω–∏—Ä–æ–≤–∞—Ç—å —á–µ–∫
            </button>
            
            <div id="scan-result" class="hidden text-center p-4 rounded-xl bg-green-50 border-2 border-green-200">
                <div class="text-green-600 font-bold text-lg">üéâ –£—Å–ø–µ—à–Ω–æ!</div>
                <div id="scan-message" class="text-sm text-green-700"></div>
            </div>
        </div>

        <!-- NFT –ö–æ–ª–ª–µ–∫—Ü–∏—è -->
        <div class="glass-card rounded-2xl p-6">
            <div class="text-center mb-4">
                <div class="w-16 h-16 bg-orange-100 rounded-full flex items-center justify-center mx-auto mb-3">
                    <span class="text-3xl">üñºÔ∏è</span>
                </div>
                <h3 class="text-xl font-bold text-orange-800 mb-2">–¢–≤–æ—è –∫–æ–ª–ª–µ–∫—Ü–∏—è NFT</h3>
                <div class="flex items-center justify-center space-x-4 text-sm">
                    <span class="text-gray-600">–°–æ–±—Ä–∞–Ω–æ:</span>
                    <span id="collection-progress" class="font-bold text-orange-600">0/9</span>
                    <span class="text-gray-600">–ü—Ä–æ–≥—Ä–µ—Å—Å:</span>
                    <span id="progress-percent" class="font-bold text-orange-600">0%</span>
                </div>
            </div>

            <!-- Progress Bar -->
            <div class="mb-6">
                <div class="w-full bg-gray-200 rounded-full h-4">
                    <div id="progress-bar" class="bg-gradient-to-r from-orange-400 to-orange-600 h-4 rounded-full transition-all duration-500" style="width: 0%"></div>
                </div>
            </div>

            <!-- NFT Grid -->
            <div id="nft-grid" class="grid grid-cols-3 gap-4 mb-4">
                <!-- NFT –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
            </div>

            <!-- –°—Ç–∞—Ç—É—Å –∫–æ–ª–ª–µ–∫—Ü–∏–∏ -->
            <div id="collection-status" class="text-center p-4 rounded-xl bg-gray-50 border-2 border-gray-200">
                <div class="text-gray-600">–ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–ª–ª–µ–∫—Ü–∏–∏...</div>
            </div>
        </div>

        <!-- –¢–æ–∫–µ–Ω—ã –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
        <div class="glass-card rounded-2xl p-6">
            <div class="text-center mb-4">
                <div class="w-16 h-16 bg-orange-100 rounded-full flex items-center justify-center mx-auto mb-3">
                    <span class="text-3xl">üí∞</span>
                </div>
                <h3 class="text-xl font-bold text-orange-800 mb-2">–¢–≤–æ–∏ —Ç–æ–∫–µ–Ω—ã</h3>
            </div>

            <div class="grid grid-cols-2 gap-4 mb-4">
                <div class="nft-card rounded-xl p-4 text-center">
                    <div class="text-2xl font-bold text-orange-600" id="total-tokens">0</div>
                    <div class="text-sm text-gray-600">–¢–æ–∫–µ–Ω–æ–≤</div>
                </div>
                <div class="nft-card rounded-xl p-4 text-center">
                    <div class="text-2xl font-bold text-orange-600" id="total-receipts">0</div>
                    <div class="text-sm text-gray-600">–ß–µ–∫–æ–≤</div>
                </div>
            </div>

            <div class="text-center text-sm text-gray-600">
                <p>üí° <strong>–°–æ–≤–µ—Ç:</strong> –ë–æ–ª—å—à–µ –ø–æ–∫—É–ø–æ–∫ = –±–æ–ª—å—à–µ —Ç–æ–∫–µ–Ω–æ–≤ –∏ NFT!</p>
            </div>
        </div>

        <!-- –ü—Ä–∏–≥–ª–∞—Å–∏ –¥—Ä—É–∑–µ–π -->
        <div class="glass-card rounded-2xl p-6">
            <div class="text-center mb-4">
                <div class="w-16 h-16 bg-orange-100 rounded-full flex items-center justify-center mx-auto mb-3">
                    <span class="text-3xl">üë•</span>
                </div>
                <h3 class="text-xl font-bold text-orange-800 mb-2">–ü—Ä–∏–≥–ª–∞—Å–∏ –¥—Ä—É–∑–µ–π</h3>
                <p class="text-gray-600 text-sm">–û–±–º–µ–Ω–∏–≤–∞–π—Å—è NFT —Å –¥—Ä—É–∑—å—è–º–∏!</p>
            </div>

            <button onclick="inviteFriends()" class="terracotta-button w-full py-3 px-6 rounded-xl font-bold mb-3">
                üì§ –ü–æ–¥–µ–ª–∏—Ç—å—Å—è —Å –¥—Ä—É–∑—å—è–º–∏
            </button>

            <div class="text-center text-sm text-gray-600">
                <p>üîó –ü–æ–¥–µ–ª–∏—Å—å —Å—Å—ã–ª–∫–æ–π –∏ –ø–æ–ª—É—á–∏ –±–æ–Ω—É—Å–Ω—ã–µ —Ç–æ–∫–µ–Ω—ã!</p>
            </div>
        </div>
    </div>

    <!-- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫–æ—à–µ–ª—å–∫–∞ -->
    <div id="wallet-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="glass-card rounded-2xl p-6 max-w-sm w-full mx-4">
            <div class="text-center mb-4">
                <div class="w-16 h-16 bg-orange-100 rounded-full flex items-center justify-center mx-auto mb-3">
                    <span class="text-3xl">üîó</span>
                </div>
                <h3 class="text-xl font-bold text-orange-800 mb-2">–ü–æ–¥–∫–ª—é—á–∏—Ç—å –∫–æ—à–µ–ª–µ–∫</h3>
                <p class="text-gray-600 text-sm">–î–ª—è —É—á–∞—Å—Ç–∏—è –≤ –ø—Ä–æ–≥—Ä–∞–º–º–µ –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏</p>
            </div>
            
            <button id="connect-wallet-btn" onclick="connectWallet()" 
                class="terracotta-button w-full py-4 px-6 rounded-xl text-lg font-bold mb-3">
                üîó –ü–æ–¥–∫–ª—é—á–∏—Ç—å –∫–æ—à–µ–ª–µ–∫
            </button>
            
            <button onclick="closeWalletModal()" 
                class="w-full py-2 px-6 rounded-xl border-2 border-gray-300 text-gray-600 font-bold">
                –û—Ç–º–µ–Ω–∞
            </button>
        </div>
    </div>

    <script>
        const API_BASE = 'http://127.0.0.1:8001/api/v1';
        let walletAddress = null;
        let isWalletConnected = false;

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        window.onload = function() {
            checkWalletConnection();
            loadUserData();
        };

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫–æ—à–µ–ª—å–∫–∞
        function checkWalletConnection() {
            const savedWallet = localStorage.getItem('wallet_address');
            if (savedWallet) {
                walletAddress = savedWallet;
                isWalletConnected = true;
                updateWalletDisplay();
                loadUserData();
            } else {
                showWalletModal();
            }
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∫–æ—à–µ–ª—å–∫–∞
        function showWalletModal() {
            document.getElementById('wallet-modal').classList.remove('hidden');
        }

        // –ó–∞–∫—Ä—ã—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∫–æ—à–µ–ª—å–∫–∞
        function closeWalletModal() {
            document.getElementById('wallet-modal').classList.add('hidden');
        }

        // –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫–æ—à–µ–ª—å–∫–∞
        function connectWallet() {
            // –î–ª—è –¥–µ–º–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–æ—à–µ–ª–µ–∫
            walletAddress = '9WzDXwBbmkg8ZTbNMqUxvQRAyrZzDsGYdLVL9zYtAWWM';
            isWalletConnected = true;
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ localStorage
            localStorage.setItem('wallet_address', walletAddress);
            updateWalletDisplay();
            closeWalletModal();
            loadUserData();
            showNotification('–ö–æ—à–µ–ª–µ–∫ –ø–æ–¥–∫–ª—é—á–µ–Ω!', 'success');
        }

        // –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        async function registerUser() {
            const response = await fetch(`${API_BASE}/register`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ wallet_address: walletAddress })
            });
            return response.json();
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∫–æ—à–µ–ª—å–∫–∞
        function updateWalletDisplay() {
            if (isWalletConnected && walletAddress) {
                document.getElementById('wallet-address').textContent = 
                    walletAddress.substring(0, 8) + '...' + walletAddress.substring(walletAddress.length - 8);
                document.getElementById('connect-wallet-btn').textContent = 'üîó –ü–æ–¥–∫–ª—é—á–µ–Ω';
                document.getElementById('connect-wallet-btn').disabled = true;
            }
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        async function loadUserData() {
            if (!isWalletConnected) return;
            updateMockUserData();
        }

        function updateMockUserData() {
            // –ë–∞–ª–∞–Ω—Å
            let balance = parseInt(localStorage.getItem('mock_balance') || '0', 10);
            document.getElementById('token-balance').textContent = `${balance} —Ç–æ–∫–µ–Ω–æ–≤`;
            document.getElementById('total-tokens').textContent = balance;
            // –ö–æ–ª–ª–µ–∫—Ü–∏—è
            let collection = JSON.parse(localStorage.getItem('mock_collection') || '[]');
            const collectionObj = {
                owned_count: collection.length,
                total_puzzles: 9,
                completion_percentage: (collection.length / 9) * 100,
                owned_puzzles: collection.map(nft => ({ name: nft, image_url: '', rarity: 'common' })),
                missing_count: 9 - collection.length
            };
            displayNFTCollection(collectionObj);
            // –ß–µ–∫–∏ (–º–æ–∫)
            document.getElementById('total-receipts').textContent = collection.length;
        }

        // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ NFT –∫–æ–ª–ª–µ–∫—Ü–∏–∏
        function displayNFTCollection(collection) {
            const nftGrid = document.getElementById('nft-grid');
            const progressBar = document.getElementById('progress-bar');
            const collectionProgress = document.getElementById('collection-progress');
            const progressPercent = document.getElementById('progress-percent');
            const collectionStatus = document.getElementById('collection-status');
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å
            const progress = collection.completion_percentage || 0;
            progressBar.style.width = `${progress}%`;
            collectionProgress.textContent = `${collection.owned_count || 0}/9`;
            progressPercent.textContent = `${progress.toFixed(1)}%`;
            
            // –°–æ–∑–¥–∞–µ–º —Å–µ—Ç–∫—É NFT
            nftGrid.innerHTML = '';
            const ownedNames = collection.owned_puzzles?.map(p => p.name) || [];
            for (let i = 0; i < 9; i++) {
                const nftDiv = document.createElement('div');
                nftDiv.className = 'aspect-square border-2 border-orange-300 rounded-lg flex items-center justify-center bg-white shadow-sm min-h-[120px]';
                let imgUrl = '';
                let label = '';
                if (i < 3) {
                    imgUrl = `images/nft_pictures/coffee_beans/coffee_bean_${i+1}.jpg`;
                    label = `coffee_bean_${i+1}`;
                } else if (i < 6) {
                    imgUrl = `images/nft_pictures/espresso/espresso_${i-2}.jpg`;
                    label = `espresso_${i-2}`;
                } else {
                    imgUrl = `images/nft_pictures/latte_art/latte_art_${i-5}.jpg`;
                    label = `latte_art_${i-5}`;
                }
                let isOwned = false;
                if (ownedNames.includes('demo_nft_123') && i === 0) {
                    isOwned = true;
                } else if (ownedNames.includes(label)) {
                    isOwned = true;
                }
                nftDiv.innerHTML = `
                    <div class="flex flex-col items-center justify-center w-full h-full">
                        <img src="${imgUrl}" alt="${label}" class="w-24 h-24 md:w-40 md:h-40 object-cover rounded mb-2" style="filter: ${isOwned ? 'none' : 'grayscale(1) opacity(0.5)'};">
                        <div class="text-xs font-bold ${isOwned ? 'text-orange-700' : 'text-gray-400'}">${isOwned ? 'NFT #' + (i+1) : '???'}</div>
                    </div>
                `;
                if (isOwned) {
                    nftDiv.className += ' border-green-400 bg-green-50';
                }
                nftGrid.appendChild(nftDiv);
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å
            if (collection.can_complete_collection) {
                collectionStatus.innerHTML = `
                    <div class="text-green-600 font-bold text-center bg-green-50 border-2 border-green-200 rounded-xl p-4">
                        üéâ –ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! –í—ã —Å–æ–±—Ä–∞–ª–∏ –ø–æ–ª–Ω—É—é –∫–æ–ª–ª–µ–∫—Ü–∏—é!
                    </div>
                `;
            } else {
                const missing = collection.missing_count || 0;
                const owned = collection.owned_count || 0;
                collectionStatus.innerHTML = `
                    <div class="text-gray-600 text-center bg-gray-50 border-2 border-gray-200 rounded-xl p-4">
                        <div class="font-bold text-orange-600 mb-1">${owned} –∏–∑ 9 NFT —Å–æ–±—Ä–∞–Ω–æ</div>
                        <div class="text-sm">–û—Å—Ç–∞–ª–æ—Å—å —Å–æ–±—Ä–∞—Ç—å: ${missing} NFT</div>
                    </div>
                `;
            }
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ —á–µ–∫–æ–≤
        async function loadReceipts() {
            try {
                const response = await fetch(`${API_BASE}/receipts/my-receipts/${walletAddress}`);
                if (response.ok) {
                    const receipts = await response.json();
                    document.getElementById('total-receipts').textContent = receipts.length;
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —á–µ–∫–æ–≤:', error);
            }
        }

        // –°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ–∫–∞ (QR-—Å—Ç—Ä–æ–∫–∞)
        async function scanReceipt() {
            const qrData = document.getElementById('qr-input').value.trim();
            if (!qrData) {
                showNotification('–í—Å—Ç–∞–≤—å—Ç–µ QR-–∫–æ–¥ —Å —á–µ–∫–∞', 'error');
                return;
            }
            try {
                const response = await fetch(`${API_BASE}/receipts/scan`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        qr_code_data: qrData,
                        scanner_wallet: walletAddress
                    })
                });
                const result = await response.json();
                showScanResult(result);
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è:', error);
                showNotification('–û—à–∏–±–∫–∞ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è —á–µ–∫–∞', 'error');
            }
        }

        // –°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ–∫–∞ –ø–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—é
    window.scanReceiptImage = function() {
            const fileInput = document.getElementById('receipt-image');
            if (!fileInput.files || !fileInput.files[0]) {
                showNotification('–ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–æ—Ç–æ —á–µ–∫–∞', 'error');
                return;
            }
            // –ú–æ–∫-–ª–æ–≥–∏–∫–∞: –Ω–∞—á–∏—Å–ª—è–µ–º —Ç–æ–∫–µ–Ω—ã –∏ NFT
            const tokensEarned = 42;
            const nftEarned = 'demo_nft_123';
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –±–∞–ª–∞–Ω—Å –∏ –∫–æ–ª–ª–µ–∫—Ü–∏—é –≤ localStorage
            let balance = parseInt(localStorage.getItem('mock_balance') || '0', 10);
            balance += tokensEarned;
            localStorage.setItem('mock_balance', balance);
            // –ú–æ–∫-–∫–æ–ª–ª–µ–∫—Ü–∏—è NFT
            let collection = JSON.parse(localStorage.getItem('mock_collection') || '[]');
            if (!collection.includes(nftEarned)) collection.push(nftEarned);
            localStorage.setItem('mock_collection', JSON.stringify(collection));
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
            showScanResult({ success: true, tokens_earned: tokensEarned, nft_earned: nftEarned });
            // –û–±–Ω–æ–≤–ª—è–µ–º UI
            updateMockUserData();
        }

        // –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –≤—ã–≤–æ–¥ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
        function showScanResult(result) {
            if (result.success) {
                document.getElementById('scan-message').innerHTML = `
                    <div class="font-bold text-green-600">+${result.tokens_earned} —Ç–æ–∫–µ–Ω–æ–≤!</div>
                    ${result.nft_earned ? `<div class="text-sm text-green-700">üéâ –ü–æ–ª—É—á–µ–Ω NFT: ${result.nft_earned}</div>` : ''}
                `;
                document.getElementById('scan-result').classList.remove('hidden');
                document.getElementById('qr-input').value = '';
                document.getElementById('receipt-image').value = '';
                // –û–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ
                loadUserData();
                showNotification('–ß–µ–∫ —É—Å–ø–µ—à–Ω–æ –æ—Ç—Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω!', 'success');
            } else {
                showNotification(result.message || '–û—à–∏–±–∫–∞ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è', 'error');
            }
        }

        // –ü—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ –¥—Ä—É–∑–µ–π
        function inviteFriends() {
            const shareText = `–ü—Ä–∏—Å–æ–µ–¥–∏–Ω—è–π—Å—è –∫ Coffee Loyalty! –°–∫–∞–Ω–∏—Ä—É–π —á–µ–∫–∏ –∏ —Å–æ–±–∏—Ä–∞–π NFT –∫–æ–ª–ª–µ–∫—Ü–∏—é! üéØ‚òï`;
            const shareUrl = window.location.href;
            
            if (navigator.share) {
                navigator.share({
                    title: 'Coffee Loyalty',
                    text: shareText,
                    url: shareUrl
                });
            } else {
                // –ö–æ–ø–∏—Ä—É–µ–º –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞
                navigator.clipboard.writeText(`${shareText}\n${shareUrl}`).then(() => {
                    showNotification('–°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞ –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞!', 'success');
                });
            }
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `fixed top-4 right-4 p-4 rounded-xl text-white font-bold z-50 ${
                type === 'success' ? 'bg-green-500' : 
                type === 'error' ? 'bg-red-500' : 'bg-blue-500'
            }`;
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }
    </script>
</body>
</html>